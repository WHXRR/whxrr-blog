---
title: "reacté¢è¯•é¢˜"
outline: deep
desc: "reactç›¸å…³çš„é¢è¯•é¢˜"
tags: "react"
updateTime: "2025-07-01 10:33"
pic: https://cdn.pixabay.com/photo/2020/08/27/09/09/village-5521554_1280.jpg
picSize: 1280x929
---

## React18 æ–°ç‰¹æ€§

::: details æŸ¥çœ‹ç­”æ¡ˆ

1. è‡ªåŠ¨æ‰¹å¤„ç†ï¼ŒåŒä¸€ä¸ªäº‹ä»¶ä¸­å¤šä¸ª setState ä¼šè¢«åˆå¹¶

2. starTransitionï¼šå¯ä»¥ç”¨æ¥åŒ…è£¹ä¸æ˜¯å¾ˆé‡è¦çš„æ›´æ–°ï¼Œreact ä¼šå…ˆå¤„ç†å…¶ä»–é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡å†æ¥å¤„ç†è¿™é‡Œçš„æ›´æ–°

3. Suspense æ”¯æŒæœåŠ¡ç«¯æ¸²æŸ“

4. React.createRoot æ›¿æ¢ React.render

5. ä¸€äº›æ–° hookï¼šuseIdï¼ŒuseDeferredValueï¼ŒuseTransition

:::

## React æ€§èƒ½ä¼˜åŒ–

::: details æŸ¥çœ‹ç­”æ¡ˆ

- åˆç†åˆ©ç”¨ memo æ¥è§„é¿å­ç»„ä»¶ä¸å¿…è¦çš„æ¸²æŸ“

- åˆç†ä½¿ç”¨ useMemo å’Œ useCallback æ¥ç¼“å­˜è®¡ç®—ç»“æœå’Œå‡½æ•°

- ä½¿ç”¨ React.lazy å°†ç»„ä»¶æ‡’åŠ è½½

- ç®€åŒ– state ä¸­çš„æ•°æ®

- å‡å°‘ Context é¢‘ç¹æ›´æ–°

:::

## React çŠ¶æ€ç®¡ç†å™¨

::: details æŸ¥çœ‹ç­”æ¡ˆ

1. Redux

![redux](/notes/react/1.jpg)

![redux](/notes/react/2.jpg)

![redux](/notes/react/3.jpg)

2. Zustand

![zustand](/notes/react/4.jpg)

![zustand](/notes/react/5.jpg)

:::

## ç›¸å¯¹äºä¼ ç»Ÿ classï¼Œ Hooks æœ‰å“ªäº›ä¼˜åŠ¿?

::: details æŸ¥çœ‹ç­”æ¡ˆ

1. å†™æ³•æ›´ç®€å•ï¼Œè€Œä¸”æ²¡æœ‰ this çš„ç»‘å®šé—®é¢˜

2. å¯ä»¥è¿›è¡Œå°è£…ï¼Œæ›´å¥½çš„å¤ç”¨

:::

## å®ç° useTimeout hook

::: details æŸ¥çœ‹ç­”æ¡ˆ

```js
import { useEffect, useRef } from "react";

export function useTimeout(callback, delay) {
  const savedCallback = useRef();

  useEffect(() => {
    savedCallback.current = callback;
  }, [callback]);

  useEffect(() => {
    if (delay !== null) {
      const timer = setTimeout(() => {
        savedCallback.current();
      }, delay);
      return () => clearTimeout(timer);
    }
  }, [delay]);
}
```

:::

## setState æ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥ï¼Ÿ

::: details æŸ¥çœ‹ç­”æ¡ˆ

åœ¨ react18 ä¹‹å‰ï¼š

åœ¨ promise.thenã€js åŸç”Ÿäº‹ä»¶ã€å®šæ—¶å™¨ç­‰æ–¹æ³•ä¸­æ˜¯åŒæ­¥çš„ã€‚

åœ¨ react çš„åˆæˆäº‹ä»¶ä¸­æ˜¯å¼‚æ­¥çš„

åœ¨ react18 ä¹‹åæ·»åŠ äº†æ‰¹å¤„ç†ï¼Œæ‰€ä»¥éƒ½æ˜¯å¼‚æ­¥çš„

:::

## ä¸ºä»€ä¹ˆè¦æœ‰åˆæˆäº‹ä»¶ï¼Ÿ

::: details æŸ¥çœ‹ç­”æ¡ˆ

1. ä¸ºäº†å…¼å®¹å„ç§æµè§ˆå™¨ï¼Œç»Ÿä¸€äº‹ä»¶è¡Œä¸º

2. react ä¼šå°†æ‰€æœ‰äº‹ä»¶ç»‘å®šåˆ° document ä¸Šï¼Œé€šè¿‡äº‹ä»¶å§”æ‰˜æ¥ç»Ÿä¸€ç®¡ç†äº‹ä»¶ï¼Œæå‡æ€§èƒ½

:::

## React ä¸­ï¼Œçˆ¶å­ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸæ‰§è¡Œé¡ºåº

::: details æŸ¥çœ‹ç­”æ¡ˆ

1. å‡½æ•°å¼ç»„ä»¶

```js
function Parent() {
  console.log("çˆ¶");
  useEffect(() => {
    console.log("ğŸ‘¨â€ğŸ‘¦ Parent mounted");
    return () => console.log("ğŸ‘¨â€ğŸ‘¦ Parent unmounted");
  }, []);

  return <Child />;
}

function Child() {
  console.log("å­");
  useEffect(() => {
    console.log("ğŸ‘¶ Child mounted");
    return () => console.log("ğŸ‘¶ Child unmounted");
  }, []);

  return <div>child</div>;
}

function App() {
  const [show, setShow] = useState(false);
  return (
    <div>
      <button onClick={() => setShow(!show)}>toggle</button>
      {show && <Parent />}
    </div>
  );
}
```

ä¸Šé¢çš„ä»£ç çš„æ‰“å°é¡ºåºæ˜¯

æŒ‚è½½æ—¶ï¼š

```
çˆ¶
å­
ğŸ‘¶ Child mounted
ğŸ‘¨â€ğŸ‘¦ Parent mounted
```

å¸è½½æ—¶ï¼š

```
ğŸ‘¨â€ğŸ‘¦ Parent unmounted
ğŸ‘¶ Child unmounted
```

2. ç±»ç»„ä»¶

```js
class Parent extends React.Component {
  constructor() {
    super();
    console.log("ğŸ‘¨â€ğŸ‘¦ Parent constructor");
  }

  componentDidMount() {
    console.log("ğŸ‘¨â€ğŸ‘¦ Parent didMount");
  }

  render() {
    return <Child />;
  }
}

class Child extends React.Component {
  constructor() {
    super();
    console.log("ğŸ‘¶ Child constructor");
  }

  componentDidMount() {
    console.log("ğŸ‘¶ Child didMount");
  }

  render() {
    return <div>child</div>;
  }
}
```

æŒ‚è½½æ—¶ï¼š

```
1. ğŸ‘¨â€ğŸ‘¦ Parent constructor
2. ğŸ‘¨â€ğŸ‘¦ Parent render
3. ğŸ‘¶ Child constructor
4. ğŸ‘¶ Child render
5. ğŸ‘¶ Child componentDidMount
6. ğŸ‘¨â€ğŸ‘¦ Parent componentDidMount
```

å¸è½½æ—¶ï¼š

```
1. ğŸ‘¶ Child componentWillUnmount
2. ğŸ‘¨â€ğŸ‘¦ Parent componentWillUnmount
```

:::

## React æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰åŸç†ï¼Ÿ

::: details æŸ¥çœ‹ç­”æ¡ˆ

æœåŠ¡ç«¯ä¼šæ ¹æ®å®¢æˆ·ç«¯è¯·æ±‚çš„è·¯å¾„ï¼Œæ‰¾åˆ°å¯¹åº”çš„ react è·¯ç”±ç»„ä»¶ï¼Œç„¶åé€šè¿‡å†…ç½®çš„ renderToString æ–¹æ³•å°†ç»„ä»¶æ¸²æŸ“æˆ html å­—ç¬¦ä¸²ï¼Œè¿”å›ç»™æµè§ˆå™¨ã€‚æµè§ˆå™¨æ‹¿åˆ°ä¹‹åä¼šè¿›è¡Œæ¸²æŸ“ï¼Œè¿˜æœ‰äº‹ä»¶çš„ç»‘å®šå’Œäº¤äº’ã€‚

:::

## useEffect å’Œ useLayoutEffect çš„åŒºåˆ«

::: details æŸ¥çœ‹ç­”æ¡ˆ
ä»–ä»¬çš„ä¸»è¦åŒºåˆ«æ˜¯æ‰§è¡Œæ—¶æœºä¸åŒï¼ŒuseLayoutEffect ä¼šåœ¨ dom æ›´æ–°å®Œæˆï¼Œæµè§ˆå™¨ç»˜åˆ¶ä¹‹å‰æ‰§è¡Œï¼Œåœ¨è¿™é‡Œåš dom çš„ä¿®æ”¹ï¼Œç”¨æˆ·æ˜¯æ„ŸçŸ¥ä¸åˆ°çš„ï¼Œè€Œä¸”ä»–æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œè¦é¿å…åšä¸€äº›è€—æ—¶è¿‡é•¿çš„äº‹æƒ…ã€‚

useEffect æ˜¯ç­‰æµè§ˆå™¨ç»˜åˆ¶å®Œæˆä¹‹åæ‰æ‰§è¡Œçš„ï¼Œå‡å¦‚åœ¨è¿™é‡Œä¿®æ”¹ dom çš„èƒŒæ™¯è‰²ä¼šå¯¼è‡´é¡µé¢é—ªçƒï¼Œä¸€èˆ¬ç”¨æ¥åšæ•°æ®è¯·æ±‚ï¼Œé€»è¾‘å¤„ç†ç­‰ä»»åŠ¡ã€‚
:::

## JSX çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ

::: details æŸ¥çœ‹ç­”æ¡ˆ

jsx æ˜¯ js çš„ä¸€ç§è¯­æ³•æ‰©å±•ï¼Œå®ƒèƒ½å¤Ÿåœ¨ js ä¸­ç¼–å†™ html çš„è¯­æ³•ã€‚éœ€è¦ç”¨ babel æ¥è½¬æˆ js ä»£ç ï¼Œç„¶åç”Ÿæˆ react å¯¹è±¡ã€‚

:::

## å¦‚ä½•ç†è§£ React Fiberï¼Ÿ

::: details æŸ¥çœ‹ç­”æ¡ˆ

react fiber æ˜¯ react ä¸ºäº†è§£å†³å¤§é‡ç»„ä»¶æ›´æ–°å¯¼è‡´é¡µé¢ ui è¢«é˜»å¡çš„é—®é¢˜è€Œè®¾è®¡çš„æ–°æ¶æ„ã€‚å®ƒèƒ½å¤ŸæŠŠä¸€æ¬¡å¤æ‚çš„æ›´æ–°ä»»åŠ¡æ‹†åˆ†æˆå¾ˆå¤šå°ä»»åŠ¡åˆ†ç‰‡æ‰§è¡Œï¼Œè¿˜å®ç°äº†å¯ä¸­æ–­ã€å¯æ¢å¤çš„å¼‚æ­¥æ¸²æŸ“ï¼Œä¼˜å…ˆçº§è°ƒåº¦ç­‰åŠŸèƒ½ã€‚

ä»¥å‰çš„ react æ˜¯é€šè¿‡é€’å½’éå†ç»„ä»¶æ ‘æ¥è¿›è¡Œæ›´æ–°çš„ï¼Œä¸€æ—¦å¼€å§‹å°±ä¸èƒ½ä¸­æ–­ã€‚å¦‚æœç»„ä»¶å¾ˆæ·±ã€è¦æ›´æ–°çš„åœ°æ–¹å¾ˆå¤šï¼Œå°±ä¼šä¸€ç›´å ç”¨ä¸»çº¿ç¨‹ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç”¨æˆ·çš„è¾“å…¥ã€åŠ¨ç”»ç­‰å˜å¾—å¡é¡¿ã€æ‰å¸§ã€‚

ç°åœ¨æ˜¯é€šè¿‡å°†è™šæ‹Ÿ dom è½¬æ¢æˆä¸€ä¸ªé“¾è¡¨ç»“æ„ï¼Œæ¯ä¸ªç»„ä»¶ä»£è¡¨ä¸€ä¸ª fiber èŠ‚ç‚¹ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š

- ç»„ä»¶ç±»å‹ï¼š æœ‰å‡½æ•°ç»„ä»¶ã€ç±»ç»„ä»¶ã€åŸç”Ÿæ ‡ç­¾

- èŠ‚ç‚¹å¯¹åº”çš„ props å’Œ state

- å‰¯ä½œç”¨ä¿¡æ¯ï¼ˆæ¯”å¦‚ useEffectã€refï¼‰

- è°ƒåº¦ä¿¡æ¯ï¼Œæ¯”å¦‚ä¼˜å…ˆçº§

- èŠ‚ç‚¹é—´çš„å…³ç³»ï¼šparentã€childã€siblingã€alternateï¼ˆå¯¹åº”æ—§èŠ‚ç‚¹ï¼‰

æ•´ä¸ªæ›´æ–°æµç¨‹è¢«æ‹†æˆä¸¤ä¸ªé˜¶æ®µï¼š

1. é¦–å…ˆæ˜¯ Renderï¼ˆè°ƒå’Œé˜¶æ®µï¼‰

React ä¼šä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œé€å±‚æ„å»ºæ–°çš„ Fiber æ ‘ï¼ŒåŒæ—¶è·Ÿæ—§çš„ Fiber æ ‘åšå¯¹æ¯”ã€‚

- å¦‚æœç±»å‹å’Œ key ä¸€æ ·ï¼Œè¡¨ç¤ºå¯ä»¥å¤ç”¨

- å¦‚æœä¸åŒåˆ™é”€æ¯é‡å»º

- å¦‚æœæ—§èŠ‚ç‚¹æœ‰ï¼Œæ–°èŠ‚ç‚¹æ²¡æœ‰ï¼Œç›´æ¥åˆ é™¤æ—§èŠ‚ç‚¹

- å¦‚æœæ—§èŠ‚ç‚¹æ²¡æœ‰ï¼Œæ–°èŠ‚ç‚¹æœ‰ï¼Œæ–°å¢èŠ‚ç‚¹

è¿™ä¸ªé˜¶æ®µæ˜¯å¯ä»¥ä¸­æ–­çš„ï¼ŒReact å¯ä»¥æ ¹æ®ä»»åŠ¡ä¼˜å…ˆçº§ã€ç©ºé—²æ—¶é—´å»è°ƒåº¦ï¼Œæå‡æ€§èƒ½ã€‚

2. ç¬¬äºŒé˜¶æ®µæ˜¯ Commitï¼ˆæäº¤é˜¶æ®µï¼‰

React ä¼šæŠŠå‰é¢æ ‡è®°å¥½çš„å˜æ›´ï¼ˆæ’å…¥ã€åˆ é™¤ã€æ›´æ–°ï¼‰ç»Ÿä¸€åº”ç”¨åˆ°çœŸå® DOM ä¸Šï¼Œè¿™ä¸ªé˜¶æ®µæ˜¯åŒæ­¥çš„ï¼Œä¸å¯ä¸­æ–­çš„ã€‚

:::

## React çš„ diff ç®—æ³•

::: details æŸ¥çœ‹ç­”æ¡ˆ

React çš„ diff ç®—æ³•æ˜¯ç”¨æ¥æ¯”è¾ƒæ–°æ—§è™šæ‹Ÿ DOM çš„å·®å¼‚çš„ï¼Œæ‰¾å‡ºå“ªäº›åœ°æ–¹éœ€è¦æ›´æ–°çš„ã€‚å®ƒçš„ç›®æ ‡æ˜¯å°½å¯èƒ½å°‘åœ°æ“ä½œçœŸå® DOMï¼Œä»¥æå‡æ€§èƒ½ã€‚

å®ƒæœ‰å‡ ä¸ªè§„åˆ™ï¼š

1. åªè¿›è¡ŒåŒå±‚æ¯”è¾ƒ

2. èŠ‚ç‚¹ç±»å‹ç›¸åŒåˆ™è¿›è¡Œå¤ç”¨ï¼Œä¸åŒåˆ™é”€æ¯é‡å»º

3. å¤šä¸ªå­èŠ‚ç‚¹æ—¶ç”¨ key æ¥è¾…åŠ©æ¯”è¾ƒ

:::

## ä¸ºä½• React JSX å¾ªç¯éœ€è¦ä½¿ç”¨ key ï¼Ÿ

::: details æŸ¥çœ‹ç­”æ¡ˆ

react é€šè¿‡ key æ¥å¯¹æ¯ä¸ªå…ƒç´ åšå”¯ä¸€æ ‡è¯†ï¼Œå¯ä»¥ç”¨æ¥å¿«é€Ÿåˆ¤æ–­å“ªäº›èŠ‚ç‚¹æ˜¯æ–°å¢çš„ï¼Œå“ªäº›èŠ‚ç‚¹æ˜¯ç§»é™¤çš„ã€‚

è¿˜èƒ½å¤Ÿé¿å…çŠ¶æ€æ··ä¹±ï¼Œå¦‚æœåˆ—è¡¨é¡¹æ˜¯è¾“å…¥æ¡†æˆ–è€…å…¶ä»–æœ‰çŠ¶æ€çš„ç»„ä»¶ï¼Œé”™è¯¯çš„ key ä¼šå¯¼è‡´ç»„ä»¶ä¸é”™è¯¯çš„å†…å®¹è¿›è¡Œç»‘å®šï¼Œå¯¼è‡´é¡µé¢æ¸²æŸ“é”™è¯¯ã€‚

:::

## React äº‹ä»¶å’Œ DOM äº‹ä»¶æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

::: details æŸ¥çœ‹ç­”æ¡ˆ

1. äº‹ä»¶åç§°ä¸ä¸€æ ·ï¼ŒåŸç”Ÿçš„äº‹ä»¶å…¨å°å†™ï¼Œreact çš„æ˜¯å°é©¼å³°å‘½åã€‚

2. äº‹ä»¶å¯¹è±¡ä¸ä¸€æ ·ï¼Œreact çš„åˆæˆäº‹ä»¶å¯¹åŸç”Ÿçš„äº‹ä»¶å¯¹è±¡è¿›è¡Œäº†ä¸€å±‚åŒ…è£…ï¼Œå¯ä»¥é€šè¿‡ e.nativeEvent è·å–åŸç”Ÿäº‹ä»¶å¯¹è±¡ã€‚

3. react äº‹ä»¶ç»‘å®šåˆ° document ä¸Šï¼Œé€šè¿‡äº‹ä»¶å§”æ‰˜æ¥å¤„ç†

:::

## ä¸ºä½• React Hooks ä¸èƒ½æ”¾åœ¨æ¡ä»¶æˆ–å¾ªç¯ä¹‹å†…ï¼Ÿ

::: details æŸ¥çœ‹ç­”æ¡ˆ

å› ä¸º React æ˜¯é è°ƒç”¨é¡ºåºæ¥åˆ¤æ–­æ¯ä¸ª Hook çš„ä½ç½®çš„ï¼Œå¦‚æœä½ æŠŠ Hook æ”¾åœ¨ if æˆ– for é‡Œé¢ï¼Œè°ƒç”¨é¡ºåºå°±å¯èƒ½ä¸ä¸€è‡´ï¼ŒReact å°±æ— æ³•æ­£ç¡®åŒ¹é…æ¯æ¬¡æ¸²æŸ“æ—¶è¯¥æ‰§è¡Œå“ªä¸ª Hookï¼Œå¯èƒ½å¯¼è‡´çŠ¶æ€é”™ä¹±æˆ–è€…æŠ¥é”™ã€‚

:::

## React çš„ç”Ÿå‘½å‘¨æœŸ

::: details æŸ¥çœ‹ç­”æ¡ˆ

react çš„ç”Ÿå‘½å‘¨æœŸåˆ†ä¸ºä¸¤ä¸ªç‰ˆæœ¬ã€‚

åœ¨ 16.3 ä¹‹å‰ï¼Œreact çš„ç”Ÿå‘½å‘¨æœŸä¸€èˆ¬åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†ï¼šæŒ‚è½½é˜¶æ®µã€æ›´æ–°é˜¶æ®µã€å¸è½½é˜¶æ®µ

- æŒ‚è½½é˜¶æ®µåŒ…æ‹¬ï¼š

  constructorï¼š æ‰§è¡Œåˆå§‹åŒ–æ“ä½œ

  componentWillMountï¼šå³å°†æŒ‚è½½æ—¶è§¦å‘

  render

  componentDidMount

- æ›´æ–°é˜¶æ®µï¼š

  componentWillReceivePropsï¼šçˆ¶ç»„ä»¶ä¼ é€’çš„å±æ€§æœ‰å˜åŒ–æ—¶è§¦å‘

  shouldComponentUpdateï¼šé€šè¿‡è¿”å›å¸ƒå°”å€¼æ¥æ§åˆ¶ç»„ä»¶æ˜¯å¦æ›´æ–°

  componentWillUpdateï¼šå³å°†æ›´æ–°æ—¶è§¦å‘

  render

  componentDidUpdate

- å¸è½½é˜¶æ®µï¼š

  componentWillUnMount

åœ¨ 16.3 ä¹‹åå¼•å…¥äº†æ–°çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼š

- æŒ‚è½½é˜¶æ®µï¼š

  constructor

  getDerivedStateFromPropsï¼šå½“ props æ”¹å˜æ—¶ï¼Œæ›´æ–° stateï¼Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ–°çš„ propsï¼Œç¬¬äºŒä¸ªæ˜¯ stateï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ state æˆ–è€… null è¡¨ç¤ºä¸å˜

  render

  componentDidMount

- æ›´æ–°é˜¶æ®µï¼š

  getDerivedStateFromProps

  shouldComponentUpdate

  render

  getSnapshotBeforeUpdateï¼šå¯ä»¥åœ¨ dom æ›´æ–°å‰è®°å½•çŠ¶æ€ï¼Œæ¯”å¦‚æ»šåŠ¨æ¡ä½ç½®

  componentDidUpdate

- å¸è½½é˜¶æ®µï¼š

  componentWillUnmount

ä¹Ÿå¯ä»¥é€šè¿‡ useEffect è¿›è¡Œæ¨¡æ‹Ÿï¼š

```js
useEffect(() => {
  console.log("componentDidMount");
}, []);

useEffect(() => {
  console.log("componentDidUpdate");
}, [deps]);

useEffect(() => {
  return () => {
    console.log("componentWillUnmount");
  };
}, []);
```

:::
